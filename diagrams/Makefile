# PlantUML ë‹¤ì´ì–´ê·¸ë¨ Makefile

.PHONY: all clean generate preview server docker-generate docker-server install help

# ê¸°ë³¸ íƒ€ê²Ÿ
all: generate

# PlantUML ì„¤ì¹˜ (macOS)
install:
	@echo "ğŸ”§ PlantUML ì„¤ì¹˜ ì¤‘..."
	@brew install plantuml graphviz || echo "Homebrewê°€ í•„ìš”í•©ë‹ˆë‹¤"
	@echo "âœ… ì„¤ì¹˜ ì™„ë£Œ"

# SVG ìƒì„± (ë¡œì»¬)
generate:
	@echo "ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì¤‘..."
	@for file in *.puml; do \
		echo "  - $$file â†’ $${file%.puml}.svg"; \
		plantuml -tsvg $$file || echo "âŒ ì‹¤íŒ¨: $$file"; \
	done
	@echo "âœ… ì™„ë£Œ!"

# PNG ìƒì„± (ë¡œì»¬)
png:
	@echo "ğŸ¨ PNG ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì¤‘..."
	@for file in *.puml; do \
		echo "  - $$file â†’ $${file%.puml}.png"; \
		plantuml -tpng $$file || echo "âŒ ì‹¤íŒ¨: $$file"; \
	done
	@echo "âœ… ì™„ë£Œ!"

# ë¯¸ë¦¬ë³´ê¸° (macOS)
preview: generate
	@echo "ğŸ–¼ï¸  ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸°..."
	@open *.svg

# PlantUML ì„œë²„ ì‹¤í–‰
server:
	@echo "ğŸŒ PlantUML ì„œë²„ ì‹œì‘..."
	@echo "ğŸ“ http://localhost:8080 ì—ì„œ ì ‘ì† ê°€ëŠ¥"
	@docker-compose up plantuml-server

# Dockerë¡œ SVG ìƒì„±
docker-generate:
	@echo "ğŸ³ Dockerë¡œ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì¤‘..."
	@docker-compose run --rm plantuml-cli
	@echo "âœ… ì™„ë£Œ!"

# Docker ì„œë²„ ì¤‘ì§€
docker-stop:
	@docker-compose down

# ìƒì„±ëœ íŒŒì¼ ì‚­ì œ
clean:
	@echo "ğŸ§¹ ìƒì„±ëœ íŒŒì¼ ì‚­ì œ ì¤‘..."
	@rm -f *.svg *.png
	@echo "âœ… ì™„ë£Œ!"

# ë„ì›€ë§
help:
	@echo "PlantUML ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë„êµ¬"
	@echo ""
	@echo "ì‚¬ìš©ë²•:"
	@echo "  make install         - PlantUML ì„¤ì¹˜ (macOS)"
	@echo "  make generate        - SVG ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±"
	@echo "  make png            - PNG ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±"
	@echo "  make preview        - ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸° (macOS)"
	@echo "  make server         - PlantUML ì›¹ ì„œë²„ ì‹¤í–‰"
	@echo "  make docker-generate - Dockerë¡œ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±"
	@echo "  make clean          - ìƒì„±ëœ íŒŒì¼ ì‚­ì œ"
	@echo "  make help           - ì´ ë„ì›€ë§ í‘œì‹œ"